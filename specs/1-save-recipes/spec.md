# Feature Specification: Save Recipes

**Feature ID**: 1-save-recipes  
**Created**: December 7, 2025  
**Status**: Ready for Planning  
**Related**: Part of Recipe Agent Backend project (extends 1-recipe-agent-backend)

## Overview

### Problem Statement

Currently, recipes generated by the Recipe Agent are ephemeralâ€”they exist only within the conversation session. Users who discover a great recipe must manually copy it elsewhere or lose it when the session ends. This creates friction and reduces the value of recipe discovery.

### Solution Summary

Implement a persistent recipe storage system that allows users to save recipes they enjoy. The agent intelligently detects user satisfaction and offers to save recipes at appropriate moments. When the user agrees, a specialized workflow captures the recipe and stores it in a database. A visual confirmation displays the saved recipe in a formatted card.

### Target Users

- **Primary User**: Home cook/mixologist who wants to build a personal recipe collection
- **Use Context**: During conversational recipe discovery, saving favorites for future reference

## Functional Requirements

### FR-1: Satisfaction Detection and Save Offer

The agent shall recognize when a user is pleased with a generated recipe and proactively offer to save it.

**Acceptance Criteria**:
- Agent detects positive user sentiment through any of:
  - Explicit verbal praise (e.g., "This is great!", "Perfect!", "Love it")
  - Stated intent to use (e.g., "I'm making this tonight", "Can't wait to try this")
  - Follow-up usage questions indicating engagement (e.g., "What wine pairs with this?", "Can I substitute the bourbon?")
- Agent offers to save the recipe in a natural, non-intrusive way
- Offer only occurs after a complete recipe has been presented
- User can decline without disrupting conversation flow
- Agent does not repeatedly offer to save the same recipe

### FR-2: User-Initiated Save

Users shall be able to explicitly request saving a recipe at any time during the conversation.

**Acceptance Criteria**:
- User can request to save a recipe using natural language (e.g., "save this", "add to my favorites", "keep this one")
- Agent confirms which recipe will be saved if multiple were discussed
- Save request works for the most recent recipe or a specifically referenced one

### FR-3: Recipe Persistence

When the user agrees to save, the system shall store the recipe in a persistent database.

**Acceptance Criteria**:
- Recipe is stored with all structured fields (name, type, ingredients, instructions, times, servings, sources)
- Saved recipes persist across sessions
- Each saved recipe has a unique identifier
- Save timestamp is recorded
- Source conversation context is optionally preserved

### FR-4: Save Workflow Execution

A dedicated workflow shall handle the save operation to ensure recipe data is properly structured and stored.

**Acceptance Criteria**:
- Save workflow extracts structured recipe data from conversation context
- Workflow validates recipe completeness before presenting approval card
- Workflow handles missing fields gracefully (optional fields can be null)
- Upon user approval (clicking "Approve"), recipe is persisted to database
- Save operation completes without blocking the main conversation
- User receives confirmation of successful save after approval

### FR-5: Interactive Recipe Approval Card

When the user agrees to save (or requests to save), an interactive card shall appear in the chat displaying the formatted recipe with approval controls.

**Acceptance Criteria**:
- Card appears in the chat interface showing the complete formatted recipe
- Recipe is displayed in a polished, readable format (name, ingredients, instructions, times)
- Card includes "Approve" and "Decline" action buttons
- Clicking "Approve" triggers the save workflow and persists the recipe
- Clicking "Decline" dismisses the card and continues conversation without saving
- Card is visually distinct from regular chat messages
- Card remains interactive until user makes a choice

### FR-6: Saved Recipe Retrieval

Users shall be able to view and access their saved recipes.

**Acceptance Criteria**:
- User can request to see saved recipes (e.g., "show my saved recipes", "what recipes have I saved?")
- Saved recipes are listed with key identifying information
- User can select a saved recipe to view full details
- Agent can reference saved recipes in conversation

### FR-7: Recipe Search and Filtering

Users shall be able to search and filter their saved recipe collection.

**Acceptance Criteria**:
- Search by recipe name or keywords
- Filter by recipe type (cocktail, food, dessert)
- Filter by ingredients
- Results are presented clearly with relevant matches highlighted

## User Scenarios & Testing

### Scenario 1: Agent-Initiated Save After Positive Feedback

**Given** a user receives a cocktail recipe and expresses satisfaction  
**When** they say "This looks perfect!" or "I'm definitely making this tonight"  
**Then** the agent offers to save the recipe, and upon agreement, an interactive approval card appears with the formatted recipe and Approve/Decline buttons.

### Scenario 2: User-Initiated Save Request

**Given** a user has received a food recipe  
**When** they say "Save this recipe" or "Add this to my collection"  
**Then** an interactive approval card appears with the formatted recipe and Approve/Decline buttons.

### Scenario 3: Approving Recipe Save via Card

**Given** an interactive approval card is displayed with a recipe  
**When** the user clicks the "Approve" button  
**Then** the recipe is saved to the database and the user receives confirmation.

### Scenario 4: Declining Recipe Save via Card

**Given** an interactive approval card is displayed with a recipe  
**When** the user clicks the "Decline" button  
**Then** the card is dismissed and the conversation continues without saving.

### Scenario 5: Viewing Saved Recipes

**Given** a user has previously saved multiple recipes  
**When** they ask "Show me my saved recipes"  
**Then** they see a list of their saved recipes with names and types.

### Scenario 6: Searching Saved Collection

**Given** a user has a collection of saved recipes  
**When** they ask "Do I have any saved cocktails with bourbon?"  
**Then** the agent searches and returns matching saved recipes.

### Scenario 7: Referencing Saved Recipe in Conversation

**Given** a user has saved a recipe previously  
**When** they ask "Can you show me that Old Fashioned recipe I saved?"  
**Then** the agent retrieves and displays the saved recipe.

## Success Criteria

| Criterion | Target | Measurement Method |
|-----------|--------|-------------------|
| Save Completion Rate | 95% of save attempts complete successfully | Track save workflow success/failure |
| Detection Accuracy | Agent offers save at appropriate moments | User feedback on timing of offers |
| Retrieval Success | Users can find saved recipes | Task completion rate for retrieval requests |
| User Satisfaction | Users find save feature valuable | Qualitative feedback on usefulness |
| Visual Clarity | Save confirmation is clear and informative | User recognition of successful save |

## Key Entities

### SavedRecipe (extends Recipe)
- ID (unique identifier)
- Recipe data (all fields from Recipe model)
- Saved timestamp
- User notes (optional, user-added comments)
- Tags (optional, user-defined categories)
- Source conversation reference (optional)

### RecipeCollection
- Collection of saved recipes
- Search/filter capabilities
- Ordering preferences

## Assumptions

1. User has a single recipe collection (no multi-user accounts needed for personal use)
2. Recipes are stored locally or in a simple persistent store (personal use context)
3. Save workflow can access conversation context to extract recipe data
4. Visual confirmation integrates with the existing chat frontend
5. The existing Recipe model provides sufficient structure for storage
6. Agent can maintain awareness of which recipes have been discussed in session

## Out of Scope

- User authentication and multi-user support
- Cloud sync across devices
- Recipe sharing with others
- Recipe modification/versioning history
- Automatic categorization/tagging
- Recipe import from external sources
- Nutritional information storage
- Shopping list integration
- Meal planning features
- Recipe rating system

## Research Required

The following resources must be reviewed during the planning phase to inform implementation:

### Generative UI Integration
- **Reference**: [Build a Generative UI App in LangGraph](https://www.youtube.com/watch?v=sCqN01R8nIQ) (LangChain official, 24 min)
- **Purpose**: Understand how to implement interactive UI components (approval cards) that integrate with LangChain/LangGraph agent workflows
- **Key Questions to Answer**:
  - How do generative UI elements fit into the LangGraph message stream?
  - What frontend framework patterns work with LangChain UI?
  - How are user interactions (button clicks) communicated back to the agent?

### LangGraph Documentation
- **Reference**: https://reference.langchain.com/python/langgraph/
- **Purpose**: Understand LangGraph 1.0 patterns for subgraphs and interrupt-based human-in-the-loop workflows

### Deep Agents
- **Reference**: https://reference.langchain.com/python/deepagents/
- **Purpose**: Multi-agent and subagent orchestration patterns for dedicated save workflow

## Dependencies

- Existing Recipe data model (`recipe_creator/models/recipe.py`)
- Conversation context access for recipe extraction
- Frontend support for interactive approval cards with action buttons
- Database or persistent storage solution
- Understanding of LangChain/LangGraph generative UI patterns (see Research Required)

---

*This specification defines WHAT the save recipes feature should do. Implementation details will be addressed in the technical planning phase.*

